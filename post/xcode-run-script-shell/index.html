<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta name="referrer" content="never">
<meta name="keywords" content="">
<meta name="description" content="欢迎访问[鼓捣猫宁]的个人博客">
<meta name="author" content="kveln">
<title>Xcode利用shell编译sdk | 鼓捣猫宁</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link
  href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'
  rel='stylesheet' type='text/css'>
<link rel="alternate" type="application/rss+xml" title="Xcode利用shell编译sdk | 鼓捣猫宁 » Feed"
  href="https://daning.netlify.app/atom.xml">
<link rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/androidstudio.min.css">
<link href="https://daning.netlify.app/styles/main.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/css/live2d.css">

<script>hljs.initHighlightingOnLoad();</script>

  <meta property="og:description" content="Xcode利用shell编译sdk" />
  <meta property="og:url" content="https://daning.netlify.app/post/xcode-run-script-shell/" />
  <meta property="og:locale" content="zh-CN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="鼓捣猫宁" />
  <!-- <script src="../assets/styles/scripts/tocScript.js"></script> -->
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://daning.netlify.app">鼓捣猫宁</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1748427018811"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
  <!-- Page Header -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="https://daning.netlify.app">鼓捣猫宁</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
      data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
      aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        
        <li class="nav-item">
          
          <a class="nav-link" href="/">首页</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/archives">归档</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/tags">标签</a>
          
        </li>
        
        <li class="nav-item">
          
          <a class="nav-link" href="/about">关于</a>
          
        </li>
        
        <li class="nav-item">
          <div class="gridea-search-container">
            <form id="gridea-search-form" style="position: relative" data-update="1748427018811"
              action="/search/index.html">
              <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
              <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
<header class="masthead" style="background-image: url('https://daning.netlify.app/media/images/home-bg.jpg')">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        
          <!-- 没Title为其他页面Header -->
          
            <!-- 没Title并且有headerType为Post：文章Header -->
            <div class="post-heading">
              <span class="tags">
                
                <a href="https://daning.netlify.app/tag/nKfqlyX-m/" class="tag">shell</a>
                
                <a href="https://daning.netlify.app/tag/ld35A2DOVM/" class="tag">Xcode</a>
                
              </span>
              <h1>Xcode利用shell编译sdk</h1>
              <span class="meta">
                Posted on
                2020-01-19，10 min read
              </span>
            </div>
          
        
      </div>
    </div>
  </div>
</header>
  <!-- Post Content -->
  <article id="post-content-article">
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto post-content-container">
          
          <p>Xcode编译工程的时候，可以在Build Phases里增加Run Script脚本，用来打包SDK、运行Python修改工程信息或者其他功能，这里简单介绍一下使用Shell脚本来辅助打包SDK的相关知识；</p>
<!-- more -->
<blockquote>
<p>在打包SDK的时候，有时要打模拟器和真机包2个包，然后进行合包从而生成模拟器和真机都支持的SDK，本文就是主要阐述如何通过Shell脚本，来实现上述步骤。</p>
</blockquote>
<h2 id="1lipo">1.lipo</h2>
<blockquote>
<p>介绍Shell前，我们需要先了解一下lipo命令。什么是lipo？从字面意思理解，它是脂肪的意思，app为了兼容不同的架构（armv7, arm64, i386, x86_64...），需要将不同平台的编译程序合并起来，生成所谓的胖文件（Fat File），而我们的lipo，就是用来干这个的。</p>
</blockquote>
<p>1.查看静态库（通用文件）支持的CPU架构</p>
<pre><code class="language-shell">lipo -info libname.a
输出：Architectures in the fat file: libname.a are: i386 x86_64 armv7 arm64
</code></pre>
<p>2.合并静态库</p>
<pre><code class="language-shell">#lipo -create 静态库存放路径1  静态库存放路径2 ...  -output 整合后存放的路径
lipo  -create  libname-armv7.a   libname-armv7s.a   libname-i386.a  -output  libname.a
</code></pre>
<p>3.静态库拆分或者“瘦身”（提取单个平台）</p>
<pre><code class="language-shell"># lipo 静态库源文件路径 -thin CPU架构名称 -output 拆分后文件存放路径
# 架构名为armv7/armv7s/arm64等，与lipo -info 输出的架构名一致
lipo  libname.a  -thin  armv7  -output  libname-armv7.a
</code></pre>
<p>4.提取、替换和去除指定CPU架构</p>
<pre><code class="language-shell"># 提取出armv7架构并新建一个通用文件，类似于-thin选项。
lipo -extract armv7 libname.a -output libname_armv7.a

#去除armv7架构
lipo -remove armv7 libname.a -output libname_exceptArmv7.a

#对输入文件libname.a中的armv7架构文件采用librepace.a进行替换，并输出到liboutput.a中
lipo libname.a -replace armv7 libreplace.a -output liboutput.a
</code></pre>
<h2 id="2shell-命令">2.Shell 命令</h2>
<blockquote>
<p>暂时不打算仔细学习Shell语法，如果以后有经常使用Shell的场景，会回头再起文章记录，这里就简单记录一下Run Script里会用到的常见语法</p>
</blockquote>
<p>1.shell中的各种括号</p>
<p>要注意的是，使用[]和[[]]的时候不要吝啬空格，每一项两边都要有空格，[[ 1 == 2 ]]的结果为“假”，但[[ 1==2 ]]的结果为“真”！后一种显然是错的</p>
<p>1.1 (): 括号中的命令将会新开一个子shell顺序执行，括号中多个命令之间用分号隔开</p>
<pre><code class="language-shell">#具体使用场景暂时未了解
#个人理解了一下，貌似是类似于在终端直接输入，例如下面我本想判断环境变量ACTION的值
if ( &quot;${ACTION}&quot; == &quot;install&quot; )
#但是输出却是 install: ==: No such file or directory
</code></pre>
<p>1.2 (()) : 是一种数学计算命令，它除了可以进行最基本的加减乘除运算，还可以进行大于、小于、等于等关系运算，以及与、或、非逻辑运算。这种扩展计算是整数型的计算，不支持浮点型（<em>没试过</em>）。</p>
<pre><code class="language-shell">#依然以这个判断为例，这样写就没问题了
if (( &quot;${ACTION}&quot; == &quot;install&quot; ))
#之前为了判断字符串相等，加了双引号，后来试了一下，不加双引号也没问题
if (( ${ACTION} == &quot;install&quot; ))
</code></pre>
<p>1.3 []：用来用于字符串比较的，不可用于整数比较</p>
<pre><code class="language-shell">#同样的，加不加双引号都行，字符串比较的话还是用[]吧
if [ &quot;${ACTION}&quot; == &quot;install&quot; ]
if [ ${ACTION} == &quot;install&quot; ]
</code></pre>
<p>1.4 [[]]：在[[和]]之间所有的字符都不会发生文件名扩展或者单词分割，但是会发生参数扩展和命令替换(<em>暂时不理解，留作备注</em>)。</p>
<pre><code class="language-shell">#支持字符串的模式匹配，例如
[[ hello == hell? ]]，结果为真
#[[ ]] 中匹配字符串或通配符，不需要引号
</code></pre>
<p>2.if elif else 语法<br>
if语法其实很简单,写 if 和 else if的时候，后面加个then就完事，写完if整个逻辑后用fi收尾即可；<br>
shell的if语法和C语言等高级语言非常相似，唯一需要注意的地方就是shell的if语句对空格方面的要求比较严格(其实shell对所有语法的空格使用都比较严格)，如果在需要空格的地方没有打上空格，都会报错。</p>
<pre><code class="language-shell">if (( $a == $b ))
then
    echo &quot;a和b相等&quot;
else if (( $a &gt; $b || $a &lt; $b))
then
    echo &quot;a不等于b&quot;
else
    echo &quot;进不来的&quot;
fi
</code></pre>
<p>3.shell中条件判断if中的-z到-d的意思</p>
<pre><code>[ -a FILE ] 如果 FILE 存在则为真。 
[ -b FILE ] 如果 FILE 存在且是一个块特殊文件则为真。
[ -c FILE ] 如果 FILE 存在且是一个字特殊文件则为真。 
[ -d FILE ] 如果 FILE 存在且是一个目录则为真。 
[ -e FILE ] 如果 FILE 存在则为真。
[ -f FILE ] 如果 FILE 存在且是一个普通文件则为真。 
[ -g FILE ] 如果 FILE 存在且已经设置了SGID则为真。 
[ -h FILE ] 如果 FILE 存在且是一个符号连接则为真。 
[ -k FILE ] 如果 FILE 存在且已经设置了粘制位则为真。 
[ -p FILE ] 如果 FILE 存在且是一个名字管道(F如果O)则为真。 
[ -r FILE ] 如果 FILE 存在且是可读的则为真。 
[ -s FILE ] 如果 FILE 存在且大小不为0则为真。  
[ -t FD ] 如果文件描述符 FD 打开且指向一个终端则为真。 
[ -u FILE ] 如果 FILE 存在且设置了SUID (set user ID)则为真。 
[ -w FILE ] 如果 FILE 如果 FILE 存在且是可写的则为真。 
[ -x FILE ] 如果 FILE 存在且是可执行的则为真。 
[ -O FILE ] 如果 FILE 存在且属有效用户ID则为真。 
[ -G FILE ] 如果 FILE 存在且属有效用户组则为真。 
[ -L FILE ] 如果 FILE 存在且是一个符号连接则为真。  
[ -N FILE ] 如果 FILE 存在 and has been mod如果ied since it was last read则为真。
[ -S FILE ] 如果 FILE 存在且是一个套接字则为真。  
[ FILE1 -nt FILE2 ] 如果 FILE1 has been changed more recently than FILE2,or 如果 FILE1 exists and FILE2 does not则为真。  
[ FILE1 -ot FILE2 ] 如果 FILE1 比 FILE2 要老, 或者 FILE2 存在且 FILE1 不存在则为真。  
[ FILE1 -ef FILE2 ] 如果 FILE1 和 FILE2 指向相同的设备和节点号则为真。 
[ -o OPTIONNAME ] 如果 shell选项 “OPTIONNAME” 开启则为真。 
[ -z STRING ] “STRING” 的长度为零则为真。  
[ -n STRING ] or [ STRING ] “STRING” 的长度为非零 non-zero则为真。 
</code></pre>
<h2 id="3xcode-环境变量">3.Xcode 环境变量</h2>
<p><code>ACTION</code>: 编译模式，archive-&gt;&quot;install&quot;、build-&gt;&quot;build&quot;</p>
<p><code>SRCROOT</code>: 根目录，~/Desktop/Linkplay/ios_muzoplayer/LPVBSKit</p>
<p><code>BUILD_ROOT</code>: 构建目录，~/Library/Developer/Xcode/DerivedData/.../Build/Products</p>
<p><code>CONFIGURATION</code>: 编译模式Debug、Release</p>
<p><code>PROJECT_NAME</code>: 工程名，LPVBSKit</p>
<p><code>TARGETNAME</code>: target名，LPBLESetupKit</p>
<p><code>BUILD_DIR</code>: 编译后路径，archive后里面分别有Release-iphoneos、iphonesimulator、universal三个文件夹 /Users/yining/.../LPVBSKit-xxx/.../LPBLESetupKit/BuildProductsPath</p>
<p><code>TARGET_BUILD_DIR</code>:也是编译路径，BUILD_DIR下的文件的原始地址 /Users/yining/.../LPVBSKit-xxx/.../LPBLESetupKit/IntermediateBuildFilesPath/UninstalledProducts/iphoneos</p>
<h2 id="4编译sdk的shell">4.编译SDK的Shell</h2>
<h3 id="41-shell代码">4.1 shell代码</h3>
<blockquote>
<p><code>格式化代码</code>加了空格仅仅<code>是为了方便阅读</code>，真实环境不用加，也不确定加了是否对使用造成影响</p>
</blockquote>
<pre><code class="language-shell">#Release-universal文件目录
UNIVERSAL_OUTPUTFOLDER=${BUILD_DIR}/${CONFIGURATION}-universal
#项目下Products文件夹的路径
INSTALL_DIR=${SRCROOT}/Products

#创建Release-universal文件目录，实验了一下，即便不手动创建，archive也会自动创建
mkdir -p &quot;${UNIVERSAL_OUTPUTFOLDER}&quot;

#删除Products文件夹
if [ -d &quot;${INSTALL_DIR}&quot; ]
then
rm -rf &quot;${INSTALL_DIR}&quot;
fi

#重新创建文件夹(-p 的作用是即使上级目录不存在，也会按目录层级自动创建目录，起一个保护作用，防止创建失败)
mkdir -p &quot;${INSTALL_DIR}&quot;

#判断是不是根调用，不是根调用，不要递归（估计就是防止多余调用）
if [ &quot;false&quot; == ${ALREADYINVOKED:-false} ]
then
    #1.首先确认是在archive
    if [ &quot;${ACTION}&quot; = &quot;install&quot; ]
    then
        #2. 设置环境变量 ALREADYINVOKED 为 true（防止多次调用,例如同个项目下，可能有多个targetSDK，如果相互引用，就能确保仅打包一个SDK了，**猜的！**）
        export ALREADYINVOKED=&quot;true&quot;

        #3. 开始编译模拟器环境SDK
        xcodebuild -target &quot;${TARGETNAME}&quot; -configuration ${CONFIGURATION} -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO BUILD_DIR=&quot;${BUILD_DIR}&quot; BUILD_ROOT=&quot;${BUILD_ROOT}&quot; clean build

        #4. 将生成的framework拷贝至universal文件夹下面(-R/r 是递归操作，会将目录下的文件/文件件一起拷贝)
        cp -R &quot;${BUILD_DIR}/${CONFIGURATION}-iphoneos/${TARGETNAME}.framework&quot; &quot;${UNIVERSAL_OUTPUTFOLDER}/&quot;

        #5. 将Release-iphonesimulator/iphoneos文件夹下的framework文件夹下的执行文件合包，替换universal文件夹下framework的执行文件
        # 注：虽然是替换了universal下的文件，但其实universal里的文件，指向的是TARGET_BUILD_DIR下的文件，所以修改universal下framework的文件，就是在修改源文件
        lipo -create -output &quot;${UNIVERSAL_OUTPUTFOLDER}/${TARGETNAME}.framework/${TARGETNAME}&quot; &quot;${BUILD_DIR}/${CONFIGURATION}-iphonesimulator/${TARGETNAME}.framework/${TARGETNAME}&quot; &quot;${BUILD_DIR}/${CONFIGURATION}-iphoneos/${TARGETNAME}.framework/${TARGETNAME}&quot;

        #6. 打开Products文件夹，并把BUILD_DIR下的framework拷贝过来（可以右键查看原文件）
        #注：这个framework其实指向的也是TARGET_BUILD_DIR下的framework，但是直接拷贝TARGET_BUILD_DIR的话，就没法右键查看原文件，其实没啥区别
        open &quot;${INSTALL_DIR}&quot;
        cp -R &quot;${BUILD_DIR}/${CONFIGURATION}-iphoneos/${TARGETNAME}.framework&quot; &quot;${INSTALL_DIR}/${TARGETNAME}.framework&quot;
    fi
fi
</code></pre>
<h3 id="42-步骤说明">4.2 步骤说明</h3>
<blockquote>
<p>Release-iPhoneos 和 Release-universal下的framework指向的其实都是TARGET_BUILD_DIR的原文件</p>
</blockquote>
<ol>
<li>archive后，先把Release-iPhoneos下的framework copy至Release-universal下</li>
<li>将Release-iphoneos和Release-iphonesimulator下的执行文件合包，并覆盖到Release-universal下</li>
<li>将Release-iphoneos拷贝至Products目录下，方便拿去使用</li>
</ol>
<h3 id="43-路径图解">4.3 路径图解</h3>
<ul>
<li>BUILD_DIR下的Release-iPhoneos/Release-universal</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://daning.netlify.app/post-images/1599467575145.png" alt="BUILD_DIR" loading="lazy"></figure>
<ul>
<li>TARGET_BUILD_DIR下的原文件</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://daning.netlify.app/post-images/1599467598275.png" alt="TARGET_BUILD_DIR" loading="lazy"></figure>

          <div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1lipo">1.lipo</a></li>
<li><a href="#2shell-%E5%91%BD%E4%BB%A4">2.Shell 命令</a></li>
<li><a href="#3xcode-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">3.Xcode 环境变量</a></li>
<li><a href="#4%E7%BC%96%E8%AF%91sdk%E7%9A%84shell">4.编译SDK的Shell</a>
<ul>
<li><a href="#41-shell%E4%BB%A3%E7%A0%81">4.1 shell代码</a></li>
<li><a href="#42-%E6%AD%A5%E9%AA%A4%E8%AF%B4%E6%98%8E">4.2 步骤说明</a></li>
<li><a href="#43-%E8%B7%AF%E5%BE%84%E5%9B%BE%E8%A7%A3">4.3 路径图解</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
          
          <hr />
          <p class="next-post">下一篇：
            <a href="https://daning.netlify.app/post/install-jekyll/">
              <span class="post-title">
                安装Jekyll&rarr;
              </span>
            </a>
          </p>
          
          <div class="comment" style="text-align: center;">
            
            <span id="/post/xcode-run-script-shell/" class="leancloud_visitors"
              data-flag-title="Xcode利用shell编译sdk">
              <em class="post-meta-item-text">阅读量 </em>
              <i class="leancloud-visitors-count">loading...</i>
            </span>
            

            
            
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'MAAasDLv2NYMtEEAn4QnnU3l-gzGzoHsz',
		appKey: 'dISXAmwDUYme6vJqsc5HgYw1',
		avatar: 'robohash',
		pageSize: 5,
		recordIp: false,
		placeholder: '来都来了，不留下点虎狼之词就走吗？',
		visitor: true,
	});
</script>

            
          </div>
        </div>
      </div>
  </article>
  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
            <li class="list-inline-item">
              <a href="https://github.com/NeedQuiet" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
            <li class="list-inline-item">
              <a href="https://www.zhihu.com/people/da-ning-40" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-zhihu fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            
              
            
              
            
              
            
              
              <!-- <li class="list-inline-item">
              <a href="https://daning.netlify.app/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li> -->
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>鼓捣猫宁</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://daning.netlify.app/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://daning.netlify.app/media/scripts/clean-blog.min.js"></script> -->
  <script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));</script>
  
  <div id="landlord-parent">
    <div id="landlord">
        <div class="message" style="opacity:0"></div>
        <canvas id="live2d" width="240" height="250" class="live2d"></canvas>
    </div>
</div>

<script type="text/javascript">
    if (/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)) {
        //移动端
        console.log("------ 移动端");
    } else {
        console.log("------ PC端 " + navigator.userAgent);

        addScript("https://cdn.jsdelivr.net/gh/850552586/ericamcdn@0.1/js/live2d.js", () => {
            // 加载完成后再loadlive2d
            loadlive2d("live2d", "https://daning.netlify.app/media/live2d/assets/hijiki.model.json");
        });

        var home_Path = "https://daning.netlify.app/";
        addScript("https://daning.netlify.app/media/live2d/js/message.js", () => { });
    }

    // 插入js文件，完成后callback
    function addScript(jsfile, callback) {
        var landlord_parent = document.getElementById("landlord-parent");
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = jsfile;
        landlord_parent.appendChild(script);
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState === "loaded" || this.readyState === "complete") {
                script.onload = script.onreadystatechange = null;
                if (callback && typeof callback == "function") {
                    callback(); //window[callback]();如果传递字符串过来 调用window['函数名']() 调用方法
                }
            }
        };
    }
</script>
  
  <script src="https://daning.netlify.app/media/scripts/tocScript.js"></script>
</body>

</html>